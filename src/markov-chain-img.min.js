!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.MarkovChainImage=t()}("undefined"!=typeof self?self:this,function(){"use strict";var e=1;const t=[{dx:-1,dy:0},{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1}];function n(t){return Math.floor(t/e)*e}function o(e){return{r:n(e.r),g:n(e.g),b:n(e.b)}}function d(e){return e.r+","+e.g+","+e.b}var MarkovChainImage=function(){this.model={}};return MarkovChainImage.prototype={setCompression:function(t){isNaN(parseInt(t))||(e=parseInt(t))},updateModel:function(e,t){void 0===this.model[e]&&(this.model[e]=[]),this.model[e].push(o(t))},feed:function(e){let n=e.width,i=e.height,r=0,s=0,a="",f={};for(let u=0;u<n;u++)for(let l=0;l<i;l++){r=u+l*n<<2,a=d(f=o({r:e.data[r],g:e.data[r+1],b:e.data[r+2]}));for(let o of t)u+o.dx>=0&&l+o.dy>=0&&u+o.dx<n&&l+o.dy<i&&(s=u+o.dx+(l+o.dy)*n<<2,this.updateModel(a,{r:e.data[s],g:e.data[s+1],b:e.data[s+2]}))}},feed_async:function(e){return new Promise(function(t,n){this.feed(e),t()}.bind(this))},getRandomColor:function(){let e=Object.keys(this.model);return function(e){let t=e.split(",");return{r:parseInt(t[0]),g:parseInt(t[1]),b:parseInt(t[2])}}(e[Math.floor(Math.random()*e.length)])},getNeighbourColor:function(e){let t=d(e);return void 0===this.model[t]?null:this.model[t][Math.floor(Math.random()*this.model[t].length)]}},"undefined"!=typeof self&&(self.onmessage=function(e){MarkovChainImage.feed_async(e.data.img).then(function(){postMessage({message:"ok"})})}),MarkovChainImage});
